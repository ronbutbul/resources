global:
  imageRegistry: "artifactory.rafael.co.il:6001"
  
  imagePullSecrets:
    - tsinf-reg
  storageClass: "tsgs-sc"

image:
  debug: true
  repository: bitnami/mongodb
  #tag : 5.0.14
  tag: 5.0.10-debian-11-r3

persistence:
  enabled: true
  storageClass: "tsgs-sc"
  size: 80Gi

# service:
#   type: ClusterIP
  # nodePort: "31017"
  

auth:
  enabled: true
  rootPassword: "MomgoTsgsAnns"
  usernames:
    - tsgsuser
  passwords:
    - tsgspassword
  databases:
    - tsgsdb
  replicaSetKey: "tsgs1010"

architecture: replicaset

useStatefulSet: true

replicaSetHostnames: true

replicaCount: 3

arbiter:
  enabled: false

externalAccess:
  enabled: false

extraDeploy:
- apiVersion: v1
  kind: Service
  metadata:
    name: mongo5rs-primary
    namespace: rafael-tsgs-cicd-flight
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
  spec:
    type: LoadBalancer
    # externalTrafficPolicy: Cluster
    ports:
      - name: mongodb
        port: 27017
        targetPort: 27017
        protocol: TCP
        
    selector:
      app.kubernetes.io/instance: mongo5rs-rafael-tsgs-cicd-flight
      primary: "true"
    
metrics:
  ## @param metrics.enabled Enable using a sidecar Prometheus exporter
  ##
  enabled: true
  
  image:
    registry: artifactory.rafael.co.il:6001
    # repository: bitnami/mongodb-exporter
    # tag: 0.33.0-debian-11-r9
    
    repository: percona/mongodb_exporter
    tag: 2.35.0
    # username: "mongodb_exporter"
    # password: "pass0wd"
   
  args:  
    - "--mongodb.uri=mongodb://mongodb_exporter:pass0wd@127.0.0.1:27017"    
    - "--log.level=info"
    - "--discovering-mode"
    - "--collect-all"    
    - "--compatible-mode"
  
  command: 
    - "/mongodb_exporter"
    
  pullPolicy: IfNotPresent
  pullSecrets: 
    - tsinf-reg
  
 

#extraDeploy: []

# initContainers: []

initContainers:
#@param sidecars Add additional sidecar containers for the MongoDB(&reg;) pod(s)

sidecars:
  - name: mongo-labeler
    image: artifactory.rafael.co.il:6001/korenlev/k8s-mongo-labeler-sidecar
    imagePullPolicy: Always
    env:
    - name: LABEL_SELECTOR
      value: "app.kubernetes.io/instance=mongo5rs-rafael-tsgs-cicd-flight"
      # value: "app.kubernetes.io/component=mongodb,app.kubernetes.io/instance=mongo5rs,app.kubernetes.io/name=mongodb"
    - name: NAMESPACE
      value: "rafael-tsgs-cicd-flight"
    - name: DEBUG
      value: "true"

rbac:
  create: true
  rules:
    - apiGroups:
        - ""
      resources:
        - pods
      verbs:
        - get
        - list
        - watch
        - update

# extraEnvVars:
#   - name: MONGODB_ADVERTISE_HOSTNAME
#     value: tsgs-saas.wwest.local
#   # - name: MONGODB_ADVERTISE_IP
#   #   value: 10.53.164.41
